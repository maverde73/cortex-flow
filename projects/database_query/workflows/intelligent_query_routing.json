{
  "name": "intelligent_query_routing",
  "description": "Intelligent routing workflow that analyzes user requests and routes to appropriate tools: database queries (MCP), web research, or direct analysis",
  "version": "1.0.0",
  "created_at": "2025-10-07T00:00:00",
  "updated_at": "2025-10-07T00:00:00",
  "metadata": {
    "author": "Cortex-Flow",
    "tags": ["database", "routing", "mcp", "intelligent", "hybrid"],
    "use_cases": [
      "Database queries about employees, projects, certifications",
      "Web research for current events and trends",
      "Hybrid analysis combining internal and external data"
    ]
  },
  "nodes": {
    "start": {
      "type": "start",
      "next": "analyze_intent"
    },
    "analyze_intent": {
      "type": "agent",
      "agent": "supervisor",
      "task": "Analyze the user request and determine the best approach:\n\n1. **Database Query** (use json_query_sse MCP tool) if request involves:\n   - Employee data (names, departments, skills, certifications)\n   - Project information (assignments, roles, budgets)\n   - Assessments and engagement results\n   - Organizational data (departments, tenants, roles)\n   - Any structured corporate data\n\n2. **Web Research** (use tavily_search tool) if request involves:\n   - Current events, news, trends\n   - External industry information\n   - Recent developments or announcements\n   - Public information not in database\n\n3. **Hybrid Approach** if request needs both:\n   - Comparing internal data with market trends\n   - Enriching database results with external context\n   - Benchmarking against industry standards\n\n4. **Direct Analysis** if request involves:\n   - Strategic recommendations\n   - Report generation from existing data\n   - Synthesis without new data gathering\n\nBased on analysis, route to appropriate next step.",
      "output_key": "intent_analysis",
      "next": "route_query"
    },
    "route_query": {
      "type": "conditional",
      "condition_field": "query_type",
      "routes": {
        "database": "execute_database_query",
        "web_research": "execute_web_research",
        "hybrid": "execute_hybrid_query",
        "analysis": "execute_analysis"
      },
      "default": "execute_database_query"
    },
    "execute_database_query": {
      "type": "agent",
      "agent": "supervisor",
      "task": "Execute database query using the json_query_sse MCP tool:\n\n1. Analyze what data is needed\n2. Construct appropriate JSON query payload following the schema\n3. Use json_query_sse tool to execute the query\n4. Process and format the results\n\nAvailable tables: employees, projects, departments, assessments, certifications, employee_certifications, project_assignments, skills, employee_skills, soft_skills, roles, sub_roles, tenants, engagement_campaigns, engagement_results, etc.\n\nReturn structured results ready for analysis.",
      "output_key": "database_results",
      "next": "synthesize_results"
    },
    "execute_web_research": {
      "type": "agent",
      "agent": "researcher",
      "task": "Conduct web research using tavily_search:\n\n1. Identify key search terms\n2. Execute web searches for relevant information\n3. Gather current data, trends, and external context\n4. Summarize findings\n\nFocus on credible sources and recent information.",
      "output_key": "research_results",
      "next": "synthesize_results"
    },
    "execute_hybrid_query": {
      "type": "parallel",
      "branches": [
        {
          "name": "database_branch",
          "node": {
            "type": "agent",
            "agent": "supervisor",
            "task": "Query internal database for relevant corporate data using json_query_sse MCP tool",
            "output_key": "internal_data"
          }
        },
        {
          "name": "research_branch",
          "node": {
            "type": "agent",
            "agent": "researcher",
            "task": "Research external data, trends, and benchmarks using web search",
            "output_key": "external_data"
          }
        }
      ],
      "merge_strategy": "combine",
      "next": "synthesize_results"
    },
    "execute_analysis": {
      "type": "agent",
      "agent": "analyst",
      "task": "Perform direct analysis based on the request without additional data gathering:\n\n1. Use existing context and knowledge\n2. Apply analytical frameworks\n3. Generate insights and recommendations\n4. Structure findings logically",
      "output_key": "analysis_results",
      "next": "synthesize_results"
    },
    "synthesize_results": {
      "type": "agent",
      "agent": "analyst",
      "task": "Synthesize all gathered information:\n\n1. Integrate data from all sources\n2. Identify key insights and patterns\n3. Draw meaningful conclusions\n4. Prepare structured analysis for report\n\nEnsure analysis is comprehensive, accurate, and actionable.",
      "output_key": "synthesis",
      "next": "generate_report"
    },
    "generate_report": {
      "type": "agent",
      "agent": "writer",
      "task": "Generate a well-structured, professional report:\n\n1. Create clear executive summary\n2. Present findings with supporting data\n3. Include visualizations or tables where appropriate\n4. Provide actionable recommendations\n5. Use professional, clear language\n\nFormat output for easy reading and understanding.",
      "output_key": "final_report",
      "next": "end"
    },
    "end": {
      "type": "end"
    }
  },
  "config": {
    "max_iterations": 20,
    "timeout_seconds": 300,
    "enable_reflection": true,
    "reflection_agents": ["analyst", "writer"],
    "enable_logging": true,
    "checkpoint_enabled": true
  },
  "examples": [
    {
      "query": "Show me all employees in the IT department with cloud certifications",
      "expected_route": "database",
      "description": "Pure database query - uses json_query_sse to query employees, departments, and certifications"
    },
    {
      "query": "What are the latest trends in AI and machine learning?",
      "expected_route": "web_research",
      "description": "Pure web research - uses tavily_search for current industry trends"
    },
    {
      "query": "Compare our team's certification levels with industry standards",
      "expected_route": "hybrid",
      "description": "Hybrid query - combines database query for internal certifications with web research for industry benchmarks"
    },
    {
      "query": "Recommend an action plan to improve employee engagement",
      "expected_route": "analysis",
      "description": "Strategic analysis - analyst generates recommendations based on best practices"
    }
  ]
}
